<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orbot - Telegram Token Checker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
    }

    #app {
      animation: fadeInUp 0.8s cubic-bezier(.22,1,.36,1) both;
    }

    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(30px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    input:focus, textarea:focus {
      outline: 2px solid #2563eb;
      outline-offset: 2px;
    }

    .fade {
      animation: fade .3s cubic-bezier(.4,0,.2,1) both;
    }
    
    @keyframes fade {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    img.avatar-preview {
      width: 84px;
      height: 84px;
      object-fit: cover;
      border-radius: 9999px;
      box-shadow: 0 4px 16px 0 #0001;
      border: 2px solid #3b82f6;
    }

    /* Modern Button Styles */
    .btn-primary {
      @apply bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold rounded-xl px-5 py-3 shadow-lg transition-all duration-300 transform hover:-translate-y-0.5;
    }

    .btn-secondary {
      @apply bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-blue-400 hover:text-blue-600 font-medium rounded-xl px-5 py-3 shadow-sm transition-all duration-300;
    }

    .btn-success {
      @apply bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-semibold rounded-xl px-5 py-3 shadow-lg transition-all duration-300 transform hover:-translate-y-0.5;
    }

    .btn-danger {
      @apply bg-gradient-to-r from-red-500 to-rose-500 hover:from-red-600 hover:to-rose-600 text-white font-semibold rounded-xl px-5 py-3 shadow-lg transition-all duration-300 transform hover:-translate-y-0.5;
    }

    .btn-outline {
      @apply bg-transparent border-2 border-blue-500 text-blue-500 hover:bg-blue-500 hover:text-white font-medium rounded-xl px-5 py-3 transition-all duration-300;
    }

    input[type="file"] {
      display: none;
    }

    input, button, select, textarea {
      font-family: inherit;
    }
    
    .nav-link {
      @apply text-gray-600 hover:text-blue-600 transition-colors duration-200;
    }
    
    .nav-link.active {
      @apply text-blue-600 font-semibold;
    }
    
    .card {
      @apply bg-white rounded-xl shadow-md p-6 border border-blue-100;
    }
    
    .feature-card {
      @apply bg-white rounded-xl shadow-sm p-5 border border-blue-50 hover:shadow-md transition-all duration-300;
    }

    /* Custom file upload button */
    .file-upload-btn {
      @apply bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white font-medium rounded-xl px-5 py-3 shadow-lg transition-all duration-300 transform hover:-translate-y-0.5 cursor-pointer;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-white flex flex-col">
  <!-- Header -->
  <header class="bg-white shadow-sm">
    <div class="container mx-auto px-4 py-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="flex items-center gap-3 mb-4 md:mb-0">
          <i class="fa-solid fa-robot text-blue-600 text-2xl"></i>
          <h1 class="text-xl font-bold text-blue-700">Orbot</h1>
        </div>
        <nav class="flex gap-6">
          <a href="#" class="nav-link active" data-page="main">Home</a>
          <a href="#" class="nav-link" data-page="stats">Statistics</a>
          <a href="#" class="nav-link" data-page="help">Help</a>
          <a href="#" class="nav-link" data-page="settings">Settings</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-grow container mx-auto px-4 py-8">
    <div id="app" class="w-full max-w-lg mx-auto">
      <!-- App content injected by JS -->
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-blue-800 text-white py-6">
    <div class="container mx-auto px-4 text-center">
      <p class="text-blue-200">Made with <i class="fa-solid fa-heart text-red-400"></i> by <a href="https://sawwqib.vercel.app">Saqib</a></p>
    </div>
  </footer>

  <script>
    // --- Token Checker Web App ---

    // --- State ---
    const app = document.getElementById('app');
    let userState = null;
    let userToken = null;
    let userBotInfo = null;
    let uploadedPhoto = null;
    let stats = {
      users: 1,
      tokensChecked: 0,
      startedAt: Date.now()
    };

    const STATE = {
      MAIN: 'main',
      WAIT_TOKEN: 'wait_token',
      WAIT_PHOTO: 'wait_photo',
      WAIT_NAME: 'wait_name',
      SHOW_RESULT: 'show_result',
      SETTINGS: 'settings',
      HELP: 'help',
      STATS: 'stats',
    };

    // --- Telegram Bot API Functions ---
    async function checkToken(token) {
      try {
        const response = await fetch(`https://api.telegram.org/bot${token}/getMe`);
        const data = await response.json();
        
        if (data.ok) {
          return {
            valid: true,
            username: data.result.username,
            first_name: data.result.first_name,
            id: data.result.id,
            can_join_groups: data.result.can_join_groups || false,
            can_read_all_group_messages: data.result.can_read_all_group_messages || false,
            supports_inline_queries: data.result.supports_inline_queries || false,
            is_bot: data.result.is_bot
          };
        } else {
          return {
            valid: false,
            error: data.description || 'Unknown error'
          };
        }
      } catch (error) {
        return {
          valid: false,
          error: 'Network error or invalid token'
        };
      }
    }

    async function setBotProfilePhoto(token, photoData) {
      try {
        const formData = new FormData();
        const blob = await (await fetch(photoData)).blob();
        formData.append('photo', blob, 'profile_photo.jpg');
        
        const response = await fetch(`https://api.telegram.org/bot${token}/setChatPhoto`, {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        return data.ok;
      } catch (error) {
        return false;
      }
    }

    async function setBotName(token, newName) {
      try {
        const response = await fetch(`https://api.telegram.org/bot${token}/setMyName`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name: newName
          })
        });
        
        const data = await response.json();
        return data.ok;
      } catch (error) {
        return false;
      }
    }

    // --- UI Rendering ---
    function render() {
      switch (userState) {
        case STATE.WAIT_TOKEN:
          renderTokenInput(); break;
        case STATE.WAIT_PHOTO:
          renderPhotoUpload(); break;
        case STATE.WAIT_NAME:
          renderNameInput(); break;
        case STATE.SETTINGS:
          renderSettings(); break;
        case STATE.HELP:
          renderHelp(); break;
        case STATE.STATS:
          renderStats(); break;
        case STATE.SHOW_RESULT:
          renderTokenResult(); break;
        default:
          renderMain(); break;
      }
    }

    function setState(state) {
      userState = state;
      render();
      updateNavigation(state);
    }

    function updateNavigation(state) {
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('data-page') === state) {
          link.classList.add('active');
        }
      });
    }

    // --- Main Page ---
    function renderMain() {
      app.innerHTML = `
        <div class="fade">
          <div class="flex flex-col items-center gap-4 mb-8">
            <div class="flex items-center gap-2 text-2xl font-bold text-blue-700">
              <i class="fa-solid fa-robot"></i>
              Orbot Token Checker
            </div>
            <div class="text-center text-gray-600 max-w-md">
              <span class="block mb-1">Validate Telegram bot tokens, change bot's image and name, and view statistics ‚Äì all in one place.</span>
            </div>
          </div>
          
          <div class="card mb-8">
            <form class="flex flex-col gap-4" id="tokenForm">
              <div class="text-lg font-semibold text-blue-700 flex items-center gap-2">
                <i class="fa-solid fa-key"></i> Check a Telegram Bot Token
              </div>
              <input class="w-full px-4 py-3 border border-blue-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg" type="text" name="token" placeholder="Paste your bot token here..." autocomplete="off" required minlength="35" spellcheck="false">
              <div class="flex flex-row gap-2">
                <button class="btn-primary flex-1" type="submit">
                  <i class="fa-solid fa-magnifying-glass mr-2"></i>Check Token
                </button>
              </div>
              <div class="text-xs text-gray-400 mt-2">Format: <span class="font-mono">123456789:ABCDEFGHIJKLMNOPQRSTUVWXYZ</span></div>
            </form>
          </div>
          </div>
        </div>
      `;
      document.getElementById('tokenForm').onsubmit = handleTokenSubmit;
    }

    async function handleTokenSubmit(e) {
      e.preventDefault();
      const token = e.target.token.value.trim();
      if (!/^\d{8,}:[a-zA-Z0-9_-]{30,}$/.test(token)) {
        showError('‚ùå Invalid token format!\n\nThe token should look like:\n123456789:ABCDEFGHIJKLMNOPQRSTUVWXYZ');
        return;
      }
      setLoading('Checking token...');
      const res = await checkToken(token);
      removeLoading();
      if (res.valid) {
        userToken = token;
        userBotInfo = res;
        stats.tokensChecked++;
        setState(STATE.SHOW_RESULT);
      } else {
        showError(`‚ùå Token check failed!\n\nReason: ${res.error}`);
      }
    }

    // --- Token Result ---
    function renderTokenResult() {
      const bot = userBotInfo;
      app.innerHTML = `
        <div class="fade flex flex-col gap-6">
          <div class="flex flex-row items-center gap-3 mb-2">
            <div class="text-2xl font-bold text-blue-700">
              <i class="fa-solid fa-circle-check mr-2 text-green-500"></i>Valid Token
            </div>
            <span class="bg-blue-50 text-blue-400 text-xs px-2 py-1 rounded-xl font-mono">@${bot.username}</span>
          </div>
          <div class="flex items-center gap-5">
            <img src="${uploadedPhoto ? uploadedPhoto : `https://api.telegram.org/bot${userToken}/getUserProfilePhotos?user_id=${bot.id}&limit=1`}" class="avatar-preview" alt="Bot profile" onerror="this.src='https://api.dicebear.com/7.x/bottts/svg?seed=' + ${bot.id}">
            <div class="flex flex-col gap-1">
              <div class="text-lg font-semibold">${bot.first_name}</div>
              <div class="text-gray-500 text-xs">ID: <span class="font-mono">${bot.id}</span></div>
              <div class="text-gray-500 text-xs">Username: @${bot.username}</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <div><i class="fa-solid fa-users mr-1 text-blue-400"></i> Join groups: <span class="font-bold">${bot.can_join_groups ? '‚úÖ' : '‚ùå'}</span></div>
            <div><i class="fa-solid fa-eye mr-1 text-blue-400"></i> Read all messages: <span class="font-bold">${bot.can_read_all_group_messages ? '‚úÖ' : '‚ùå'}</span></div>
            <div><i class="fa-solid fa-bolt mr-1 text-blue-400"></i> Inline queries: <span class="font-bold">${bot.supports_inline_queries ? '‚úÖ' : '‚ùå'}</span></div>
            <div><i class="fa-solid fa-robot mr-1 text-blue-400"></i> Is Bot: <span class="font-bold">${bot.is_bot ? '‚úÖ' : '‚ùå'}</span></div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <button class="btn-outline" onclick="setState(STATE.WAIT_PHOTO)">
              <i class="fa-solid fa-image mr-2"></i>Change Image
            </button>
            <button class="btn-outline" onclick="setState(STATE.WAIT_NAME)">
              <i class="fa-solid fa-pen-to-square mr-2"></i>Change Name
            </button>
            <button class="btn-secondary" onclick="recheckToken()">
              <i class="fa-solid fa-arrows-rotate mr-2"></i>Re-examine
            </button>
            <button class="btn-danger" onclick="deletePhoto()">
              <i class="fa-solid fa-trash mr-2"></i>Remove Image
            </button>
          </div>
          <button class="btn-primary mt-4" onclick="setState(STATE.MAIN)">
            <i class="fa-solid fa-house mr-2"></i>Back to Main
          </button>
        </div>
      `;
    }

    async function recheckToken() {
      setLoading('Re-checking token...');
      const res = await checkToken(userToken);
      removeLoading();
      if (res.valid) {
        showToast('‚úÖ The token is still valid!');
        userBotInfo = res;
        setState(STATE.SHOW_RESULT);
      } else {
        showError('‚ùå The token is no longer valid!');
        setState(STATE.MAIN);
      }
    }

    function deletePhoto() {
      uploadedPhoto = null;
      showToast('üóëÔ∏è Local image removed!');
      setState(STATE.SHOW_RESULT);
    }

    // --- Photo Upload ---
    function renderPhotoUpload() {
      app.innerHTML = `
        <form class="fade flex flex-col gap-6 items-center" id="photoForm">
          <div class="text-xl font-bold text-blue-700 flex items-center gap-2">
            <i class="fa-solid fa-image"></i> Change Bot Image
          </div>
          <label for="photoInput" class="cursor-pointer flex flex-col items-center gap-2">
            <img src="${uploadedPhoto ? uploadedPhoto : `https://api.telegram.org/bot${userToken}/getUserProfilePhotos?user_id=${userBotInfo.id}&limit=1`}" class="avatar-preview mb-2" alt="Preview" onerror="this.src='https://api.dicebear.com/7.x/bottts/svg?seed=' + ${userBotInfo.id}">
            <span class="file-upload-btn inline-flex items-center">
              <i class="fa-solid fa-cloud-arrow-up mr-2"></i>Choose Image (JPG/PNG, <5MB)
            </span>
            <input type="file" accept="image/jpeg,image/png" id="photoInput">
          </label>
          <div class="flex gap-3 w-full">
            <button class="btn-success flex-1" type="submit">
              <i class="fa-solid fa-upload mr-2"></i>Upload to Bot
            </button>
            <button class="btn-secondary" type="button" onclick="setState(STATE.SHOW_RESULT)">
              <i class="fa-solid fa-xmark mr-2"></i>Cancel
            </button>
          </div>
        </form>
      `;
      document.getElementById('photoForm').onsubmit = handlePhotoSubmit;
      document.getElementById('photoInput').onchange = handlePhotoChange;
    }

    function handlePhotoChange(e) {
      const file = e.target.files[0];
      if (!file) return;
      if (!/^image\/(jpeg|png)$/.test(file.type)) {
        showError('‚ùå Only JPG or PNG images are allowed!');
        return;
      }
      if (file.size > 5 * 1024 * 1024) {
        showError('‚ùå Image must be less than 5MB!');
        return;
      }
      const reader = new FileReader();
      reader.onload = function(ev) {
        uploadedPhoto = ev.target.result;
        renderPhotoUpload();
      };
      reader.readAsDataURL(file);
    }

    async function handlePhotoSubmit(e) {
      e.preventDefault();
      if (!uploadedPhoto) {
        showError('Please select an image first!');
        return;
      }
      setLoading('Uploading image...');
      const success = await setBotProfilePhoto(userToken, uploadedPhoto);
      removeLoading();
      if (success) {
        showToast('‚úÖ Bot image changed successfully!');
        setState(STATE.SHOW_RESULT);
      } else {
        showError('‚ùå Failed to change bot image!');
      }
    }

    // --- Name Change ---
    function renderNameInput() {
      app.innerHTML = `
        <form class="fade flex flex-col gap-6" id="nameForm">
          <div class="text-xl font-bold text-blue-700 flex items-center gap-2">
            <i class="fa-solid fa-pen-to-square"></i> Change Bot Name
          </div>
          <input class="w-full px-4 py-3 border border-blue-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg" type="text" name="newName" placeholder="Enter new bot name..." autocomplete="off" required minlength="1" maxlength="64" value="${userBotInfo.first_name}">
          <div class="flex flex-row gap-3">
            <button class="btn-success flex-1" type="submit">
              <i class="fa-solid fa-check mr-2"></i>Update Name
            </button>
            <button class="btn-secondary" type="button" onclick="setState(STATE.SHOW_RESULT)">
              <i class="fa-solid fa-xmark mr-2"></i>Cancel
            </button>
          </div>
          <div class="text-xs text-gray-400 mt-2">1‚Äì64 characters. Letters, numbers, symbols.</div>
        </form>
      `;
      document.getElementById('nameForm').onsubmit = handleNameSubmit;
    }

    async function handleNameSubmit(e) {
      e.preventDefault();
      const newName = e.target.newName.value.trim();
      if (newName.length < 1 || newName.length > 64) {
        showError('‚ùå Name must be between 1 and 64 characters!');
        return;
      }
      setLoading('Changing name...');
      const success = await setBotName(userToken, newName);
      removeLoading();
      if (success) {
        userBotInfo.first_name = newName;
        showToast(`‚úÖ Bot name changed successfully!`);
        setState(STATE.SHOW_RESULT);
      } else {
        showError('‚ùå Failed to change bot name!');
      }
    }

    // --- Settings ---
    function renderSettings() {
      app.innerHTML = `
        <div class="fade flex flex-col gap-6">
          <div class="text-xl font-bold text-blue-700 flex items-center gap-2">
            <i class="fa-solid fa-gear"></i> Settings
          </div>
          <div class="flex flex-col gap-3">
            <button class="btn-secondary" onclick="clearData()">
              <i class="fa-solid fa-broom mr-2"></i>Clear Token History
            </button>
            <button class="btn-secondary" onclick="resetState()">
              <i class="fa-solid fa-rotate-left mr-2"></i>Reset User Status
            </button>
            <button class="btn-outline" onclick="showLastToken()">
              <i class="fa-solid fa-key mr-2"></i>View Last Checked Token
            </button>
          </div>
          <button class="btn-primary mt-4" onclick="setState(STATE.MAIN)">
            <i class="fa-solid fa-house mr-2"></i>Back to Main
          </button>
        </div>
      `;
    }
    
    function clearData() {
      userToken = null;
      userBotInfo = null;
      uploadedPhoto = null;
      showToast('üóëÔ∏è All saved data has been cleaned!');
      setState(STATE.SETTINGS);
    }
    
    function resetState() {
      userToken = null;
      userBotInfo = null;
      uploadedPhoto = null;
      showToast('üîÑ User status has been reset!');
      setState(STATE.SETTINGS);
    }
    
    function showLastToken() {
      if (!userToken) {
        showError('No token checked yet.');
        return;
      }
      showToast(`Last token: ${userToken}`);
    }

    // --- Help ---
    function renderHelp() {
      app.innerHTML = `
        <div class="fade flex flex-col gap-6">
          <div class="text-xl font-bold text-blue-700 flex items-center gap-2">
            <i class="fa-solid fa-circle-question"></i> Help
          </div>
          <ul class="list-disc list-inside text-gray-600 text-sm space-y-1">
            <li><b>Token check:</b> Enter Telegram bot token to view details and validity.</li>
            <li><b>Change image:</b> Upload a new image for bot using Telegram API.</li>
            <li><b>Change name:</b> Edit bot's display name using Telegram API.</li>
            <li><b>Statistics:</b> View tokens checked and uptime.</li>
            <li><b>Settings:</b> Clear data, reset status, view last token.</li>
          </ul>
          <div class="bg-blue-50 border border-blue-100 rounded-lg p-3 text-xs text-blue-500">
            <i class="fa-solid fa-lightbulb text-yellow-400 mr-1"></i>
            This tool uses real Telegram Bot API calls. All changes are applied to actual bot.
          </div>
          <button class="btn-primary mt-4" onclick="setState(STATE.MAIN)">
            <i class="fa-solid fa-house mr-2"></i>Back to Main
          </button>
        </div>
      `;
    }

    // --- Statistics ---
    function renderStats() {
      const uptimeSec = Math.floor((Date.now() - stats.startedAt) / 1000);
      const uptimeStr =
        uptimeSec < 60 ? `${uptimeSec} sec` :
        uptimeSec < 3600 ? `${Math.floor(uptimeSec / 60)} min` :
        `${Math.floor(uptimeSec / 3600)} hr`;
      app.innerHTML = `
        <div class="fade flex flex-col gap-6">
          <div class="text-xl font-bold text-blue-700 flex items-center gap-2">
            <i class="fa-solid fa-chart-simple"></i> Statistics
          </div>
          <div class="flex flex-col gap-2 text-gray-700 text-sm">
            <div><i class="fa-solid fa-users mr-1 text-blue-400"></i> Users: <b>${stats.users}</b></div>
            <div><i class="fa-solid fa-key mr-1 text-blue-400"></i> Tokens checked: <b>${stats.tokensChecked}</b></div>
            <div><i class="fa-solid fa-clock mr-1 text-blue-400"></i> Uptime: <b>${uptimeStr}</b></div>
            <div><i class="fa-solid fa-bolt mr-1 text-blue-400"></i> Bot status: <span class="text-green-600">Running</span></div>
          </div>
          <button class="btn-primary mt-4" onclick="setState(STATE.MAIN)">
            <i class="fa-solid fa-house mr-2"></i>Back to Main
          </button>
        </div>
      `;
    }

    // --- Toast & Loading ---
    function showToast(msg) {
      let toast = document.createElement('div');
      toast.className = 'fixed bottom-24 right-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl shadow-lg px-5 py-3 fade z-50';
      toast.innerHTML = msg;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.classList.remove('fade');
        toast.style.opacity = 0;
        setTimeout(() => toast.remove(), 400);
      }, 1800);
    }
    
    function showError(msg) {
      let err = document.createElement('div');
      err.className = 'fixed top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-red-500 to-rose-500 text-white rounded-xl shadow-lg px-6 py-3 fade z-50 text-center';
      err.innerHTML = `<i class='fa-solid fa-triangle-exclamation mr-2'></i>${msg}`;
      document.body.appendChild(err);
      setTimeout(() => {
        err.classList.remove('fade');
        err.style.opacity = 0;
        setTimeout(() => err.remove(), 400);
      }, 2700);
    }
    
    let loadingDiv = null;
    function setLoading(msg) {
      removeLoading();
      loadingDiv = document.createElement('div');
      loadingDiv.className = 'fixed inset-0 bg-black/20 flex items-center justify-center z-50 fade';
      loadingDiv.innerHTML = `
        <div class='bg-white px-8 py-6 rounded-2xl shadow-lg flex flex-col items-center gap-3'>
          <i class='fa-solid fa-spinner fa-spin text-blue-600 text-2xl'></i>
          <span class='text-blue-700 font-semibold'>${msg}</span>
        </div>`;
      document.body.appendChild(loadingDiv);
    }
    
    function removeLoading() {
      if (loadingDiv) { loadingDiv.remove(); loadingDiv = null; }
    }

    // --- Navigation Event Listeners ---
    document.addEventListener('DOMContentLoaded', function() {
      // Add click handlers for navigation links
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const page = this.getAttribute('data-page');
          setState(page);
        });
      });
      
      // Initialize the app
      setState(STATE.MAIN);
    });
  </script>
</body>
</html>